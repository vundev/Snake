var util;!function(util){var Hash=function(){function Hash(object){void 0===object&&(object=null),object&&this.merge(object)}return Hash.prototype.merge=function(object,recursive){if(void 0===recursive&&(recursive=!0),void 0==object)return this;for(var keys=Object.keys(object),_i=0;_i<keys.length;_i++){var name=keys[_i];null!==object[name]&&(recursive&&this.instanceIsObjOrHash(this[name])&&this.instanceIsObjOrHash(object[name])?this[name]=new Hash(this[name]).merge(object[name],recursive):this[name]=object[name])}return this},Hash.prototype.instanceIsObjOrHash=function(instance){return void 0!=instance&&("Object"===instance.constructor.name||instance.constructor.className===Hash.className)},Hash.prototype.isEmpty=function(){return 0==Object.keys(this).length},Hash.prototype.has=function(){for(var rest=[],_i=0;_i<arguments.length;_i++)rest[_i-0]=arguments[_i];for(var _a=0;_a<rest.length;_a++){var needle=rest[_a];if(needle instanceof Array&&this.has.apply(this,needle))return!0;if(void 0!==this[needle])return!0}return!1},Object.defineProperty(Hash.prototype,"length",{get:function(){return Object.keys(this).length},enumerable:!0,configurable:!0}),Object.defineProperty(Hash.prototype,"values",{get:function(){for(var v=[],keys=Object.keys(this),_i=0;_i<keys.length;_i++){var name=keys[_i];v.push(this[name])}return v},enumerable:!0,configurable:!0}),Hash.prototype.diff=function(other){for(var h=new Hash,keys=Object.keys(this),_i=0;_i<keys.length;_i++){var name=keys[_i];void 0!==other[name]&&other[name]==this[name]||(h[name]=this[name])}return h},Hash.prototype.mapValues=function(callback){for(var h=new Hash,keys=Object.keys(this),_i=0;_i<keys.length;_i++){var name=keys[_i];h[name]=callback(name,this[name])}return h},Hash.prototype.dup=function(){return new Hash(this)},Hash.prototype.withoutKeys=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i-0]=arguments[_i];var keys=args[0]instanceof Array?args[0]:args,h=new Hash;return this.forEach(function(k,v){keys.indexOf(k)<0&&(h[k]=this[k])}),h},Hash.prototype.forEach=function(check){for(var keys=Object.keys(this),_i=0;_i<keys.length;_i++){var name=keys[_i];check.call(this,name,this[name])}},Hash.prototype.toObject=function(){var object={};return this.forEach(function(k,v){object[k]=this[k]}),object},Hash.className="gamy.Hash",Hash}();util.Hash=Hash}(util||(util={}));var snake;!function(snake){var Hash=util.Hash,Stage=function(){function Stage(options){options=new Hash({stageWidth:500,stageHeight:500,canvasID:"stage"}).merge(options),this._renderer=PIXI.autoDetectRenderer(options.stageWidth,options.stageHeight,{roundPixels:!0}),$("#"+options.canvasID).append(this._renderer.view),this._renderer.backgroundColor=6710886,this._stage=new PIXI.Container,this.animate()}return Stage.prototype.animate=function(){this._renderer.render(this._stage);var that=this;requestAnimationFrame(function(){that.animate()})},Object.defineProperty(Stage.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Stage}();snake.Stage=Stage}(snake||(snake={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},snake;!function(snake){var Mediator=puremvc.Mediator,Stage=snake.Stage,StageMediator=function(_super){function StageMediator(){_super.call(this,StageMediator.NAME)}return __extends(StageMediator,_super),StageMediator.prototype.onRegister=function(){_super.prototype.onRegister.call(this),this.viewComponent=new Stage({stageWidth:1024,stageHeight:640})},Object.defineProperty(StageMediator.prototype,"view",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),StageMediator.NAME="StageMediator",StageMediator}(Mediator);snake.StageMediator=StageMediator}(snake||(snake={}));var util;!function(util){var ArrayTools=function(){function ArrayTools(){throw new Error("static class")}return ArrayTools.has=function(collection,what){return collection.indexOf(what)>-1},ArrayTools.print=function(array){for(var output="",length=array.length,i=0;i<length;i++){var comma=i==length-1?"":",",element=array[i];output+=element instanceof Array?ArrayTools.print(element)+comma:"Object"===element.constructor.name?new util.Hash(element).toString()+comma:element+comma}return"["+output+"]"},ArrayTools.isEmpty=function(array){return 0==array.length},ArrayTools.remove=function(array,elem){return array.filter(function(item,index,arr){return item!=elem})},ArrayTools.diff=function(array,compare){for(var unique=[],length=array.length,i=0;i<length;i++)ArrayTools.has(compare,array[i])||unique.push(array[i]);return unique},ArrayTools.intersect=function(array1,array2){var intersection=[],l1=array1.length,l2=array2.length;if(l1<l2)for(var i=0;i<l1;i++)ArrayTools.has(array2,array1[i])&&intersection.push(array1[i]);else for(var i=0;i<l2;i++)ArrayTools.has(array1,array2[i])&&intersection.push(array2[i]);return intersection},ArrayTools.htmlCollectionToArray=function(collection){return[].slice.call(collection)},ArrayTools.flatten=function(array){for(var flattened=[],length=array.length,i=0;i<length;i++){var item=array[i];item instanceof Array?flattened=flattened.concat(ArrayTools.flatten(item)):flattened.push(item)}return flattened},ArrayTools}();util.ArrayTools=ArrayTools}(util||(util={}));var layout;!function(layout){var Container=PIXI.Container,ArrayTools=util.ArrayTools,Hash=util.Hash,Holder=function(_super){function Holder(options){_super.call(this),this._options=new Hash({autoDispose:!0}).merge(options),this._options.autoDispose&&this.on("removed",this.onRemoveFromDisplayTree,this)}return __extends(Holder,_super),Holder.prototype.onRemoveFromDisplayTree=function(event){this.off("removed",this.onRemoveFromDisplayTree,this),this.dispose()},Holder.prototype.dispose=function(){this.hasListener("removed")&&this.off("removed",this.onRemoveFromDisplayTree,this);for(var length=this.children.length,i=0;i<length;i++){var child=this.children[i];"function"==typeof child.dispose&&child.dispose()}},Holder.prototype.attrs=function(options){if(options)for(var keys=Object.keys(options),_i=0;_i<keys.length;_i++){var name=keys[_i];this[name]=options[name]}return this},Holder.prototype.addChildren=function(){for(var rest=[],_i=0;_i<arguments.length;_i++)rest[_i-0]=arguments[_i];for(var children=ArrayTools.flatten(rest),length=children.length,i=0;i<length;i++)children[i].parent!=this&&this.addChild(children[i])},Holder.prototype.hasListener=function(type){return this.listeners(type).length>0},Holder}(Container);layout.Holder=Holder}(layout||(layout={}));var layout;!function(layout){var MovieClip=PIXI.extras.MovieClip,SpriteSheet=function(_super){function SpriteSheet(frames){this._frames=frames,_super.call(this,this.frames())}return __extends(SpriteSheet,_super),SpriteSheet.prototype.frames=function(){for(var frames=[],length=this._frames.length,i=0;i<length;i++)frames[i]=this._frames[i].texture;return frames},SpriteSheet.prototype.gotoAndStopToLabel=function(label){for(var length=this._frames.length,i=0;i<length;i++)if(this._frames[i].label==label){this.gotoAndStop(i);break}},SpriteSheet.prototype.dispose=function(){for(var length=this._frames.length,i=0;i<length;i++)this._frames[i].dispose();this._frames.length=0},SpriteSheet}(MovieClip);layout.SpriteSheet=SpriteSheet;var Frame=function(){function Frame(texture,label){this.texture=texture,this.label=label}return Frame.prototype.dispose=function(){this.texture=null},Frame}();layout.Frame=Frame}(layout||(layout={}));var util;!function(util){function isMobile(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}util.isMobile=isMobile}(util||(util={}));var util;!function(util){!function(EVENT_TYPE){EVENT_TYPE[EVENT_TYPE.CLICK=0]="CLICK",EVENT_TYPE[EVENT_TYPE.MOVE=1]="MOVE",EVENT_TYPE[EVENT_TYPE.DOWN=2]="DOWN",EVENT_TYPE[EVENT_TYPE.UP=3]="UP",EVENT_TYPE[EVENT_TYPE.OVER=4]="OVER",EVENT_TYPE[EVENT_TYPE.OUT=5]="OUT"}(util.EVENT_TYPE||(util.EVENT_TYPE={}));var EVENT_TYPE=util.EVENT_TYPE,Capabilities=function(){function Capabilities(){throw new Error("static class")}return Object.defineProperty(Capabilities,"scaleFactor",{get:function(){return window.devicePixelRatio<2?1:window.devicePixelRatio<3?2:3},enumerable:!0,configurable:!0}),Capabilities.eventType=function(type){switch(type){case EVENT_TYPE.CLICK:return util.isMobile()?"tap":"click";case EVENT_TYPE.MOVE:return util.isMobile()?"touchmove":"mousemove";case EVENT_TYPE.DOWN:return util.isMobile()?"touchstart":"mousedown";case EVENT_TYPE.UP:return util.isMobile()?"touchend":"mouseup";case EVENT_TYPE.OVER:return util.isMobile()?"pointerover":"mouseover";case EVENT_TYPE.OUT:return util.isMobile()?"touchendoutside":"mouseout"}return null},Capabilities.isPrimaryTouchPoint=function(event){if(util.isMobile()){var touches=event.data.originalEvent.touches;return 0==touches.length||event.data.identifier==touches[0].identifier}return!0},Capabilities}();util.Capabilities=Capabilities}(util||(util={}));var layout;!function(layout){var Hash=util.Hash,Graphics=PIXI.Graphics,Capabilities=util.Capabilities,EVENT_TYPE=util.EVENT_TYPE,Button=function(_super){function Button(src,options){void 0===src&&(src=null),void 0===options&&(options=null),_super.call(this,options),this.graphics=new Graphics,this._options=new Hash({supportedStates:{idle:11589905},label:!0,defaultGraphics:!0,enableEff:!1}).merge(this._options),this.src=src,this.addChild(this.graphics),this.src&&this.addChild(this.src),this._options.label&&(this.createLabel(),this.addChild(this.label)),this._options.enableEff&&(this.on(Capabilities.eventType(EVENT_TYPE.DOWN),this.onDown,this),this.on(Capabilities.eventType(EVENT_TYPE.OVER),this.onOver,this),this.on(Capabilities.eventType(EVENT_TYPE.UP),this.onUp,this),this.on(Capabilities.eventType(EVENT_TYPE.OUT),this.onUp,this))}return __extends(Button,_super),Button.prototype.onOver=function(event){try{this.src.gotoAndStopToLabel("over")}catch(error){}},Button.prototype.onDown=function(event){try{this.src.gotoAndStopToLabel("down")}catch(error){}},Button.prototype.onUp=function(event){try{this.src.gotoAndStopToLabel(this._state)}catch(error){}},Button.prototype.createLabel=function(){this.label=new PIXI.Text("Game Type",{font:"Arial",fontSize:13,fill:"#ffffff"}),this.label.text="label"},Button.prototype.getState=function(){return this._state},Button.prototype.setState=function(value){this._state=value;try{this.src.gotoAndStopToLabel(this._state)}catch(error){if(this._options.defaultGraphics){this.graphics.clear();var color=void 0!=this._options.supportedStates[this._state]?this._options.supportedStates[this._state]:Button.STATE_UNSUPPORTED;this.graphics.beginFill(color),this.graphics.drawRect(0,0,44,44),this.graphics.endFill()}}},Button.prototype.dispose=function(){_super.prototype.dispose.call(this),this.src&&this.src.parent==this&&(this.removeChild(this.src),this.src=null),this.label&&this.label.destroy(!0),this.label=null,this.graphics=null,this._options.enableEff&&(this.removeAllListeners(Capabilities.eventType(EVENT_TYPE.DOWN)),this.removeAllListeners(Capabilities.eventType(EVENT_TYPE.UP)),this.removeAllListeners(Capabilities.eventType(EVENT_TYPE.OVER)),this.removeAllListeners(Capabilities.eventType(EVENT_TYPE.OUT)))},Button.STATE_UNSUPPORTED=16711680,Button}(layout.Holder);layout.Button=Button}(layout||(layout={}));var snake;!function(snake_1){var Holder=layout.Holder,Button=layout.Button,SpriteSheet=layout.SpriteSheet,SnakeGrid=function(_super){function SnakeGrid(rows,columns,design){_super.call(this),this.previous_snake=[],design=design||{},this.rows=rows,this.columns=columns;for(var padding=2,i=0;i<rows;i++)for(var j=0;j<columns;j++){var cell=new Button(design.cellFrames?new SpriteSheet(design.cellFrames):null,{supportedStates:{selected:16711680},label:!1});this.addChild(cell),cell.setState("idle"),cell.x=j*(cell.width+padding),cell.y=i*(cell.height+padding)}}return __extends(SnakeGrid,_super),SnakeGrid.prototype.clear=function(){if(this.previous_snake.length>0){for(var length_1=this.previous_snake.length,i=0;i<length_1;i++)this.getCell(this.previous_snake[i]).setState("idle");this.previous_food&&this.getCell(this.previous_food).setState("idle")}},SnakeGrid.prototype.update=function(snake,food){this.clear();for(var length=snake.length,i=0;i<length;i++)this.getCell(snake[i]).setState("selected");this.getCell(food).setState("selected"),this.previous_food=food,this.previous_snake=this.clone(snake)},SnakeGrid.prototype.clone=function(snake){for(var clone=[],length=snake.length,i=0;i<length;i++)clone[i]=snake[i].clone();return clone},SnakeGrid.prototype.getCell=function(point){return this.children[this.columns*point.y+point.x]},SnakeGrid}(Holder);snake_1.SnakeGrid=SnakeGrid}(snake||(snake={}));var snake;!function(snake_2){var Holder=layout.Holder,TilingSprite=PIXI.extras.TilingSprite,Texture=PIXI.Texture,Sprite=PIXI.Sprite,Container=PIXI.Container,SnakeGridOptimized=function(_super){function SnakeGridOptimized(rows,columns,design){_super.call(this),this.snakeAndFood=new Container,design=design||{},this.rows=rows,this.columns=columns,design.cellIdle instanceof Texture&&design.cellSelected instanceof Texture&&(this.cellIdle=design.cellIdle,this.cellSelected=design.cellSelected,this.grid=new TilingSprite(design.cellIdle,columns*this.cellIdle.width,rows*this.cellIdle.height),this.addChild(this.grid),this.addChild(this.snakeAndFood))}return __extends(SnakeGridOptimized,_super),SnakeGridOptimized.prototype.update=function(snake,food){this.snakeAndFood.removeChildren(),snake=snake.concat(food);for(var length=snake.length,i=0;i<length;i++){var cell=new Sprite(this.cellSelected);this.snakeAndFood.addChild(cell),cell.x=snake[i].x*cell.width,cell.y=snake[i].y*cell.height}},SnakeGridOptimized}(Holder);snake_2.SnakeGridOptimized=SnakeGridOptimized}(snake||(snake={}));var snake;!function(snake){var Mediator=puremvc.Mediator,SnakeGridMediator=function(_super){function SnakeGridMediator(){_super.call(this,SnakeGridMediator.NAME)}return __extends(SnakeGridMediator,_super),SnakeGridMediator.prototype.onRegister=function(){_super.prototype.onRegister.call(this);var that=this;this._proxy=this.facade().retrieveProxy(snake.SnakeProxy.NAME);var appProxy=this.facade().retrieveProxy(snake.AppProxy.NAME),scoreLabel=new PIXI.Text("Score",{fontSize:20,fill:"#000000"});this.viewComponent=new snake.SnakeGridOptimized(this._proxy.settings.rows,this._proxy.settings.columns,{cellIdle:appProxy.getTexture("grey"),cellSelected:appProxy.getTexture("yellow")}),this._proxy.onUpdate=function(){that.viewComponent.update(this.snake,this.food),scoreLabel.text="Score: "+this.score},this._proxy.onGameOver=function(){alert("Game Over with score: "+this.score),location.reload()};var stage=this.facade().retrieveMediator(snake.StageMediator.NAME);stage.view.stage.addChild(this.viewComponent),stage.view.stage.addChild(scoreLabel),this._proxy.start(),scoreLabel.x=this.viewComponent.x+this.viewComponent.width+10},SnakeGridMediator.NAME="SnakeGridMediator",SnakeGridMediator}(Mediator);snake.SnakeGridMediator=SnakeGridMediator}(snake||(snake={}));var util;!function(util){var Vector=function(){function Vector(type){this.items=[],this._type=type}return Object.defineProperty(Vector.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(Vector.prototype,"length",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),Vector.prototype.map=function(callback){for(var length=this.length,mapped=new Vector(this.type),i=0;i<length;i++)mapped.items.push(callback(this.items[i],i,this));return mapped},Vector}();util.Vector=Vector}(util||(util={}));var util;!function(util){var Vector=util.Vector,Externalizable=function(){function Externalizable(){}return Externalizable.prototype.serialize=function(withObject){if(null==withObject)return null;for(var keys=Object.keys(this),_i=0;_i<keys.length;_i++){var name=keys[_i];if(this[name]instanceof Externalizable)this[name].serialize(withObject[name]);else if(name in withObject)if(this[name]instanceof Vector)for(var length=withObject[name].length,vectorType=this[name].type,vector=this[name],i=0;i<length;i++)vector.items[i]=new vectorType,vector.items[i]instanceof Externalizable?vector.items[i].serialize(withObject[name][i]):vector.items[i]=withObject[name][i];else this[name]=withObject[name]}return this},Externalizable}();util.Externalizable=Externalizable}(util||(util={}));var snake;!function(snake){var Externalizable=util.Externalizable,SnakeSettings=function(_super){function SnakeSettings(){_super.apply(this,arguments),this.rows=30,this.columns=30,this.speed=100}return __extends(SnakeSettings,_super),SnakeSettings}(Externalizable);snake.SnakeSettings=SnakeSettings}(snake||(snake={}));var snake;!function(snake){var SnakeDirection,Proxy=puremvc.Proxy,Point=PIXI.Point;!function(SnakeDirection){SnakeDirection[SnakeDirection.left=0]="left",SnakeDirection[SnakeDirection.right=1]="right",SnakeDirection[SnakeDirection.up=2]="up",SnakeDirection[SnakeDirection.down=3]="down"}(SnakeDirection||(SnakeDirection={}));var SnakeProxy=function(_super){function SnakeProxy(){_super.call(this,SnakeProxy.NAME),this.direction=SnakeDirection.down,this.snake=[new Point(0,0)],this.direction_flag=!0,this.score=0,this.settings=new snake.SnakeSettings}return __extends(SnakeProxy,_super),SnakeProxy.prototype.onRegister=function(){var appProxy=this.facade().retrieveProxy(snake.AppProxy.NAME);this.settings.serialize(appProxy.content.snake);var that=this;document.onkeydown=function(event){if(that.direction_flag){var keyCode=event.keyCode;switch(keyCode){case 37:that.direction!=SnakeDirection.right&&(that.direction=SnakeDirection.left);break;case 39:that.direction!=SnakeDirection.left&&(that.direction=SnakeDirection.right);break;case 38:that.direction!=SnakeDirection.down&&(that.direction=SnakeDirection.up);break;case 40:that.direction!=SnakeDirection.up&&(that.direction=SnakeDirection.down)}that.direction_flag=!1,event.preventDefault(),console.log("direction: "+that.direction)}}},SnakeProxy.prototype.start=function(){this.createFood();var that=this;this.timer_id=setInterval(function(){that.update()},this.settings.speed),this.onUpdate.call(this)},SnakeProxy.prototype.update=function(){var x=this.snake[0].x,y=this.snake[0].y;if(this.direction==SnakeDirection.right?x++:this.direction==SnakeDirection.left?x--:this.direction==SnakeDirection.up?y--:this.direction==SnakeDirection.down&&y++,x==-1||x==this.settings.columns||y==-1||y==this.settings.rows||this.collisionCheck(new Point(x,y)))return this.stop(),void this.onGameOver.call(this);if(this.direction_flag=!0,x==this.food.x&&y==this.food.y){var tail=new Point(x,y);this.score++,this.createFood()}else tail=this.snake.pop(),tail.x=x,tail.y=y;this.snake.unshift(tail),this.onUpdate.call(this)},SnakeProxy.prototype.stop=function(){clearInterval(this.timer_id)},SnakeProxy.prototype.collisionCheck=function(point){for(var length=this.snake.length,i=0;i<length;i++)if(this.snake[i].equals(point))return!0;return!1},SnakeProxy.prototype.createFood=function(){this.food=new Point(Math.floor(Math.random()*this.settings.columns),Math.floor(Math.random()*this.settings.rows)),this.collisionCheck(this.food)&&(this.food=new Point(Math.floor(Math.random()*this.settings.columns),Math.floor(Math.random()*this.settings.rows)))},SnakeProxy.NAME="SnakeProxy",SnakeProxy}(Proxy);snake.SnakeProxy=SnakeProxy}(snake||(snake={}));var snake;!function(snake){var Proxy=puremvc.Proxy,AppProxy=function(_super){function AppProxy(){_super.call(this,AppProxy.NAME)}return __extends(AppProxy,_super),AppProxy.prototype.onRegister=function(){this.load()},AppProxy.prototype.load=function(){var that=this,semaphore=2,loader=new PIXI.loaders.Loader,url=this.libraryPath();loader.add(url),loader.load(function(){that._atlas=loader.resources[url].textures,semaphore--,0==semaphore&&that.onLoad.call(this)}),$.ajax({cache:!0,dataType:"json",url:this.contentUrl(),contentType:"application/json; charset=utf-8",crossDomain:!1,success:function(data){that._content=data,semaphore--,0==semaphore&&that.onLoad.call(this)}})},AppProxy.prototype.libraryPath=function(){return"../assets/library.json?version=0.0.0"},AppProxy.prototype.contentUrl=function(){return"../assets/content.json?version=0.0.0"},AppProxy.prototype.getTexture=function(name,ext){return void 0===ext&&(ext="png"),null==this._atlas?null:this._atlas[name+(ext?"."+ext:"")]},Object.defineProperty(AppProxy.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),AppProxy.NAME="AppProxy",AppProxy}(Proxy);snake.AppProxy=AppProxy}(snake||(snake={}));var snake;!function(snake){function start(onComplete){var appProxy=new snake.AppProxy;appProxy.onLoad=onComplete,Facade.getInstance(Main.CORE_NAMESPACE).registerProxy(appProxy)}var Facade=puremvc.Facade,StageMediator=snake.StageMediator,Main=function(){function Main(){console.log("debug: "+!0),console.log("version: 0.0.0"),Facade.getInstance(Main.CORE_NAMESPACE).registerMediator(new StageMediator),Facade.getInstance(Main.CORE_NAMESPACE).registerProxy(new snake.SnakeProxy),Facade.getInstance(Main.CORE_NAMESPACE).registerMediator(new snake.SnakeGridMediator)}return Main.CORE_NAMESPACE="snake",Main}();snake.Main=Main,snake.start=start}(snake||(snake={}));
//# sourceMappingURL=snake.debug.min.js.map